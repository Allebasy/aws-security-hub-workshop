


<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="AWS Security Hub allows you to centrally view and manage security alerts and automate security checks across AWS accounts. This workshop provides hands on experience with the full functionality that Security Hub provides. Your workshop starts with a guided tour of the Security Hub UI and its features. Next, you will integrate security findings from AWS services, learn how to integrate 3rd party security findings for your AWS environment, and build out your own custom security finding integration. Finally, you will respond to the security findings in your environment by taking action via manual and automated response techniques.">
      
      
        <link rel="canonical" href="https://aws-security-hub-workshop.awssecworkshops.com/02-custom-insights-findings/">
      
      
        <meta name="author" content="aws-security-workshops@amazon.com">
      
      <link rel="shortcut icon" href="../assets/images/aws-favicon.ico">
      <meta name="generator" content="mkdocs-1.1.2, mkdocs-material-5.4.0">
    
    
      
        <title>Module 2: Custom Insights & Findings - Integration, Prioritization, and Response with AWS Security Hub</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.fe0cca5b.min.css">
      
      
    
    
    
      
        <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style>
      
    
    
    
      <link rel="stylesheet" href="../stylesheets/custom.css">
    
    
      
    
    
  </head>
  
  
    <body dir="ltr">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#module-2-custom-insights-and-custom-findings" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
      <!--
  Copyright (c) 2016-2018 Martin Donath <martin.donath@squidfunk.com>
  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:
  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.
  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->

<!-- Application header -->
<header class="md-header" data-md-component="header">

    <!-- Top-level navigation -->
    <nav class="md-header-nav md-grid">
      <div class="md-flex">
  
        <!-- Link to home -->
        <div class="md-flex__cell md-flex__cell--shrink">
          <a href="https://aws.amazon.com/"
              title="Amazon Web Services"
              class="md-header-nav__button md-logo">
            
              <img src="../assets/images/aws_smile_logo.png" width="40" height="24" />
            
          </a>
        </div>
  
        <!-- Button to toggle drawer -->
        <div class="md-flex__cell md-flex__cell--shrink">
          <label class="md-icon md-icon--menu md-header-nav__button"
              for="__drawer"></label>
        </div>
  
        <!-- Header title -->
        <div class="md-flex__cell md-flex__cell--stretch">
          <div class="md-flex__ellipsis md-header-nav__title"
              data-md-component="title">
            
              
                <span class="md-header-nav__topic">
                  Integration, Prioritization, and Response with AWS Security Hub
                </span>
                <span class="md-header-nav__topic">
                  Module 2: Custom Insights & Findings
                </span>
              
            
          </div>
        </div>
        
        
        <!-- Button to open search dialogue -->
        <!--
        <div class="md-flex__cell md-flex__cell--shrink">
          
            
              <label class="md-icon md-icon--search md-header-nav__button"
                  for="__search"></label>
  
              
<div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" data-md-state="active">
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <button type="reset" class="md-search__icon md-icon" aria-label="Clear" data-md-component="search-reset" tabindex="-1">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
      </button>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
            
          
        </div>

         -->
         
         <div class="md-flex__cell md-flex__cell--shrink">
            <div class="md-flex__ellipsis md-header-nav__lang">
                <div>
                    <button onclick="window.location.href = 'https://awssecworkshops.com/';" class="md-lang-dropbtn fa fa-home"></button>
                </div>
            </div>
        </div>
  
        <!-- Repository containing source -->
        
          <div class="md-flex__cell md-flex__cell--shrink">
            <div class="md-header-nav__source">
              
<a href="https://github.com/aws-samples/aws-security-hub-workshop/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    aws-samples/aws-security-hub-workshop
  </div>
</a>
            </div>
          </div>
        
      </div>
    </nav>
  </header>
    
    <div class="md-container" data-md-component="container">
      
        
      
      
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <!--
  Copyright (c) 2016-2019 Martin Donath <martin.donath@squidfunk.com>
  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:
  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.
  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->

<!-- Main navigation -->
<nav class="md-nav md-nav--primary" data-md-level="0">

    <!-- Site title -->
    <label class="md-nav__title md-nav__title--site" for="__drawer">
      <a href="https://aws-security-hub-workshop.awssecworkshops.com/"
          title="Integration, Prioritization, and Response with AWS Security Hub" class="md-nav__button md-logo">
        
          <img src="../assets/images/aws_smile_logo.png" width="48" height="48" />
        
      </a>
      Security Hub Workshop
    </label>
  
    <!-- Repository containing source -->
    
      <div class="md-nav__source">
        
<a href="https://github.com/aws-samples/aws-security-hub-workshop/" title="Go to repository" class="md-source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    aws-samples/aws-security-hub-workshop
  </div>
</a>
      </div>
    
  
    <!-- Render item list -->
    <ul class="md-nav__list" data-md-scrollfix>
      
        
        
        


  <li class="md-nav__item">
    <a href=".." title="Overview" class="md-nav__link">
      Overview
    </a>
  </li>

      
        
        
        


  <li class="md-nav__item">
    <a href="../00-environment-setup/" title="Module 0: Environment Build" class="md-nav__link">
      Module 0: Environment Build
    </a>
  </li>

      
        
        
        


  <li class="md-nav__item">
    <a href="../01-security-hub-walk-through/" title="Module 1: Security Hub Walkthrough" class="md-nav__link">
      Module 1: Security Hub Walkthrough
    </a>
  </li>

      
        
        
        

  


  <li class="md-nav__item md-nav__item--active">
    
    <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
    
      
    
    
      <label class="md-nav__link md-nav__link--active" for="__toc">
        Module 2: Custom Insights & Findings
        <span class="md-nav__icon md-icon">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 9h14V7H3v2m0 4h14v-2H3v2m0 4h14v-2H3v2m16 0h2v-2h-2v2m0-10v2h2V7h-2m0 6h2v-2h-2v2z"/></svg>
        </span>
      </label>
    
    <a href="./" title="Module 2: Custom Insights & Findings" class="md-nav__link md-nav__link--active">
      Module 2: Custom Insights & Findings
    </a>
    
      
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#create-custom-findings-with-aws-config" class="md-nav__link">
    Create Custom Findings with AWS Config
  </a>
  
    <nav class="md-nav" aria-label="Create Custom Findings with AWS Config">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-eventbridge-rule" class="md-nav__link">
    Create EventBridge Rule
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-a-rule-to-track-approved-amis" class="md-nav__link">
    Create a rule to track approved AMIs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#view-the-noncompliant-ami-finding-in-security-hub" class="md-nav__link">
    View the noncompliant AMI finding in Security Hub
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-custom-insights-for-custom-findings" class="md-nav__link">
    Create Custom Insights for Custom Findings
  </a>
  
</li>
      
    </ul>
  
</nav>
    
  </li>

      
        
        
        


  <li class="md-nav__item">
    <a href="../03-remediation-and-response/" title="Module 3: Remediation & Response" class="md-nav__link">
      Module 3: Remediation & Response
    </a>
  </li>

      
        
        
        


  <li class="md-nav__item">
    <a href="../04-enrichment-and-integration/" title="Module 4: Enrichment & Integration" class="md-nav__link">
      Module 4: Enrichment & Integration
    </a>
  </li>

      
        
        
        


  <li class="md-nav__item">
    <a href="../contribute/" title="Contributing" class="md-nav__link">
      Contributing
    </a>
  </li>

      
        
        
        


  <li class="md-nav__item">
    <a href="../LICENSE" title="License" class="md-nav__link">
      License
    </a>
  </li>

      
    </ul>
  </nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#create-custom-findings-with-aws-config" class="md-nav__link">
    Create Custom Findings with AWS Config
  </a>
  
    <nav class="md-nav" aria-label="Create Custom Findings with AWS Config">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-eventbridge-rule" class="md-nav__link">
    Create EventBridge Rule
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-a-rule-to-track-approved-amis" class="md-nav__link">
    Create a rule to track approved AMIs
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#view-the-noncompliant-ami-finding-in-security-hub" class="md-nav__link">
    View the noncompliant AMI finding in Security Hub
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#create-custom-insights-for-custom-findings" class="md-nav__link">
    Create Custom Insights for Custom Findings
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
              
                
                  <a href="https://github.com/aws-samples/aws-security-hub-workshop/edit/master/docs/02-custom-insights-findings.md" title="Edit this page" class="md-content__button md-icon">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
                  </a>
                
                
                  
                
                
                <h1 id="module-2-custom-insights-and-custom-findings">Module 2: Custom Insights and Custom Findings</h1>
<p>A key feature of Security Hub is the ability to create security findings that are above and beyond the native integrations that Security Hub has with AWS services or 3rd party providers.  This custom findings feature gives customers the flexibility to build their security checks against their AWS environment and import them into Security Hub.</p>
<p>In the environment for this workshop, multiple sources that are sending custom findings into Security Hub:
* The open-source Cloud Custodian project running on an EC2 instance.
* A Config Rule checking for non-compliant AMIs.
* A Lambda function looking for non-compliant secrets.</p>
<p>This module will guide you on how to either view or fully integrate these findings sources into Security Hub.</p>
<p><strong>Agenda</strong></p>
<ol>
<li>Create Custom Findings with AWS Config  - 15 min</li>
<li>Create Custom Insight for Custom Findings - 10 min</li>
</ol>
<h2 id="create-custom-findings-with-aws-config">Create Custom Findings with AWS Config</h2>
<p>In this section we will cover how you can create your own findings in Security Hub.  The foundation for this section will be using AWS Config Rules to identify compliance violations and then posting those violations into Security Hub. </p>
<p>This is a representation of the architecture you will be implementing: </p>
<p><img alt="Config" src="../images/02-config-architecture.png" /></p>
<p>For this part of the workshop a Config rule has already been defined.  The specific Config rule being used is <strong>approved-amis-by-id</strong>.  This rule looks for EC2 instances backed by AMIs that are not in the rule's list of approved AMIs.  Any EC2 instances that are not using an AMI that is in the approved list will be reported by the rule as noncompliant.</p>
<h3 id="create-eventbridge-rule">Create EventBridge Rule</h3>
<p>This section creates the rule which will catch messages sent from Config rules about noncompliant resources and route them to a target.</p>
<ol>
<li>
<p>Navigate to the Amazon EventBridge Console.</p>
</li>
<li>
<p>Click on the <strong>Create rule</strong> on the right side.</p>
</li>
</ol>
<p><img alt="Custom Action" src="../images/03-custom-eventbridge.png" /></p>
<ol>
<li>In the Create rule page give your rule a <strong>name</strong> and a <strong>description</strong> that represents the rule's purpose.</li>
</ol>
<p><img alt="Custom Action" src="../images/02-custom-create-rule.png" /></p>
<div class="admonition info">
<p class="admonition-title">All Config Rule output is sent as events to the AWS default event bus.  The define pattern section allows you to identify filters to take a specific action when matched events appear.</p>
</div>
<ol>
<li>
<p>Under Define pattern, select <strong>Event pattern</strong>. </p>
</li>
<li>
<p>Select <strong>Pre-defined pattern by service</strong>.</p>
</li>
<li>
<p>In the drop down for <strong>Service Provider</strong>, select <strong>AWS</strong>.</p>
</li>
<li>
<p>In the drop down for <strong>Service Name</strong>, select or type and select <strong>Config</strong>.</p>
</li>
<li>
<p>Choose <strong>Config Rules Compliance Change</strong> for the <strong>Event Type</strong>. </p>
</li>
<li>
<p>Chose the <strong>Specific rule name(s)</strong> radio button and enter <strong>approved-amis-by-id</strong> in the text box.</p>
</li>
</ol>
<p><img alt="Custom Action" src="../images/02-custom-create-event-source.png" /></p>
<ol>
<li>Under Select targets, ensure <strong>Lambda function</strong> is populated in the top drop down and then select <strong>ec2-non-compliant-ami-sechub</strong> lambda function. </li>
</ol>
<p><img alt="Custom Action" src="../images/02-custom-create-confirm.png" /></p>
<div class="admonition info">
<p class="admonition-title"><strong>ec2-non-compliant-ami-sechub</strong> is a custom Lambda function created during the setup of this workshop.  Feel free to look at the function to learn more about how it integrates with Security Hub.</p>
</div>
<ol>
<li>Click <strong>Create</strong>.</li>
</ol>
<h3 id="create-a-rule-to-track-approved-amis">Create a rule to track approved AMIs</h3>
<p>This section will run the config rule to generate information on noncompliant resources and send them to Security Hub.</p>
<ol>
<li>
<p>Navigate to the <strong>AWS Config</strong> dashboard</p>
</li>
<li>
<p>From the Config Dashboard click <strong>Rules</strong> on the left menu.</p>
</li>
</ol>
<p><img alt="Config" src="../images/02-config-dashboard.png" /></p>
<p>!!! Make sure to not choose Rules from the Aggregated view menu.  This requires Config Aggregator and this feature is not used in this workshop.</p>
<ol>
<li>In the Rules page there will be one rule named <strong>approved-amis-by-id</strong>.  Click on the rule name to go to the detail page for that rule.  </li>
</ol>
<p>In the rule detail screen you will see the rule configured with a list of approved AMIs.  There will also be one resource showing as noncompliant. Now that the EventBridge is in place you want to see the noncompliant instances show in Security Hub as a finding.</p>
<p><img alt="Config" src="../images/02-approved-ami-config-rule.png" /></p>
<ol>
<li>
<p>Click on the <strong>Delete results</strong> button.  In the confirmation popup click <strong>Delete</strong>.</p>
</li>
<li>
<p>Click on the refresh button in the <strong>Choose resources in scope</strong> section.  The noncompliant resource section should now be empty.  </p>
</li>
<li>
<p>Click the <strong>Re-evaluate</strong> button.  You will get a message that the Config rule is in use and that you need to refresh the page.  At this point you can either refresh the entire page in your browser or use the refresh button in the <strong>Choose resources in scope</strong> section of the page.</p>
</li>
</ol>
<p>An instance should now be showing as noncompliant in the <strong>Choose resources in scope</strong> section.  This re-run of the config rule will trigger the EventBridge rule that is looking for noncompliant resources, resulting in the finding showing in Security Hub.  </p>
<p>!!!Clearing results and re-evaluating the config rule is being done to help force sending findings into Security Hub for this workshop.  Under normal circumstances you will not need manually run the config rule in order to get findings to show in Security Hub.  Once you have the Config and EventBridge rules configured, new noncompliant resources will automatically flow into Security Hub as a config rule finds noncompliant resources.  </p>
<h3 id="view-the-noncompliant-ami-finding-in-security-hub">View the noncompliant AMI finding in Security Hub</h3>
<ol>
<li>
<p>Navigate to the <strong>Security Hub</strong> dashboard. </p>
</li>
<li>
<p>Click on the <strong>Findings</strong> option in the left-hand navigate menu. </p>
</li>
<li>
<p>You should see a rule towards the top of the findings list with a <strong>Company</strong> of <strong>Personal</strong> and a <strong>Title</strong> about an unapproved AMI for an instance.  This is the result of your compliance rule and its integration with EventBridge.  Click on the <strong>Title</strong> link for the finding to view more details for your finding.</p>
</li>
</ol>
<p><img alt="Config" src="../images/02-unapproved-ami-finding.png" /></p>
<p>You now have setup in place that helps demonstrate how you can send custom findings into Security Hub using AWS data sources and EventBridge rules.</p>
<p>!!!In your environment the Lambda function <strong>find-secrets-without-rotation</strong> checks for secrets that have a rotation time that is beyond the max days parameter on the function.  When secrets are found with a rotation time beyond what is defined in the function a finding is created in Security Hub.  Take some time to explore the Lambda function to see how you can directly send custom findings into Security Hub.  </p>
<h2 id="create-custom-insights-for-custom-findings">Create Custom Insights for Custom Findings</h2>
<p>This section will walk you through how to create a custom insight to give you more visibility around the sources that are sending findings into Security Hub for custom findings.</p>
<p>When a custom finding is sent into Security Hub it will have a company of <strong>Personal</strong> and a product of <strong>Default</strong>.  Unlike integrations from AWS services and approved 3rd parties, you cannot use the Company and/or Product fields to determine the source of your finding for custom findings.</p>
<p>However, Security Hub provides the ability to create insights that filter on more attributes than you can see from the initial findings console.  You can filter on additional attributes that are passed in as part of a finding that enable you to get more granular in how you filter findings.</p>
<p>For this lab the custom findings have been built to utilize the Generator ID field in the AWS Security Finding Format (ASFF) to help in identifying sources of findings.  </p>
<ol>
<li>
<p>Navigate to the <strong>Security Hub</strong> dashboard.</p>
</li>
<li>
<p>Choose <strong>Insights</strong> from the left hand navigation.</p>
</li>
<li>
<p>Click <strong>Create insight</strong>.</p>
</li>
<li>
<p>Click in the filter field at the top to add additinal filters.</p>
</li>
<li>
<p>Choose a filter field of <strong>Company name</strong>.  Choose a filter match type of <strong>EQUALS</strong> and a value of <strong>Personal</strong>.
<img alt="Config" src="../images/02-create-custom-insight-company-filter.png" /></p>
</li>
<li>
<p>Choose a filter field of <strong>Product name</strong>.  Choose a filter match type of <strong>EQUALS</strong> and a value of <strong>Default</strong>.</p>
</li>
<li>
<p>Choose a Grouping of <strong>Group by:</strong>.  In the list of options choose <strong>Generator ID</strong>.<br />
<img alt="Config" src="../images/02-create-custom-insight-grouping.png" /></p>
</li>
<li>
<p>Click on <strong>Create insight</strong> to save your custom insight.</p>
</li>
<li>
<p>Give your insight a name that is meaningful to you and click <strong>Create insight</strong>.
<img alt="Config" src="../images/02-create-custom-insight-name.png" /></p>
</li>
<li>
<p><strong>Refresh</strong> your browser to reload the screen with Graphs.</p>
</li>
</ol>
<p>You now have a custom insight that allows you to get more visibility around custom findings that are coming into Security Hub, allowing you more visibility into what your security findings are related to, what the source of the findings are, and where you should prioritize your remediation efforts. <br />
For the findings in this custom insight you can click on the resource ID links to drill into the specific findings related to those resources. </p>
<p>Feel free to play with the grouping for your insight to see other attributes that you can group by and the different views of data it creates.  </p>
<p><img alt="Config" src="../images/02-custom-insight-final.png" /></p>
                
              
              
                


              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid" aria-label="Footer">
        
          <a href="../01-security-hub-walk-through/" title="Module 1: Security Hub Walkthrough" class="md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
            </div>
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                Module 1: Security Hub Walkthrough
              </div>
            </div>
          </a>
        
        
          <a href="../03-remediation-and-response/" title="Module 3: Remediation & Response" class="md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-footer-nav__title">
              <div class="md-ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Module 3: Remediation & Response
              </div>
            </div>
            <div class="md-footer-nav__button md-icon">
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            &copy; 2020, Amazon Web Services, Inc. or its affiliates. All rights reserved.
          </div>
        
        Made with
        <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
          Material for MkDocs
        </a>
      </div>
      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/vendor.d710d30a.min.js"></script>
      <script src="../assets/javascripts/bundle.b39636ac.min.js"></script><script id="__lang" type="application/json">{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents"}</script>
      
      <script>
        app = initialize({
          base: "..",
          features: [],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.a68abb33.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script>
      
    
  </body>
</html>